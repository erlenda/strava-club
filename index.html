<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Strava Club Distance</title>
  
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/5.3.0/Rx.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  
  <style type="text/css">
  .strava-badge img {
    visibility: hidden;
  }
  .strava-badge { 
    height: 50px; 
    width: 50px; 
    background: url(http://badges.strava.com/echelon-sprite-48.png) no-repeat 0 0; }
  
  html { font-size: 62.5%; // most often 10px }
  body { font-size: 1.6rem; }
  html, body {
    font-family: 'Lato';//, sans-serif;
    font-weight: 300;
    margin: 0;
    padding: 0;
    color: #fff;
  }
  
  .row {
    display: table;
    background-color: #fc4c02;
    height: 3rem;

    border: 1px solid transparent;
    border-right: none;
    -webkit-border-top-left-radius: 8px;
    -webkit-border-bottom-left-radius: 8px;
    -moz-border-radius-topleft: 8px;
    -moz-border-radius-bottomleft: 8px;
    border-top-left-radius: 8px;
    border-bottom-left-radius: 8px;
  }
  
  .col {
    display: table-cell;
    vertical-align: middle;
    padding-right: 10px;
  }
  
  .col__text {
    font-size: 1.2rem; // 16px probably?
  }
  
  .col__text--large {
    font-size: 3rem; // 24px probably?
  }
  
  .text--half {
    font-size: 0.5rem;
  }

  #result {
    margin: 0 auto;
    text-align: center;
  }
  </style>
  
</head>
<body>
  <div class="row">
    <a class="col strava-badge" target="_blank" href="https://www.strava.com/dashboard?club_id=197332&feed_type=club">
      <img src="http://badges.strava.com/echelon-sprite-48.png" alt="Bjørgvin IF" />
    </a>
    <div class="col col__text--large" id="result"> load </div>
    <div class="col col__text" id="result">Bjørgvin IF<br />last 30 days</div>
  </div>
<script>
var result = document.getElementById('result');
var at = '?access_token=e2fdf0035cdea4ad570b3770c958ed3afcf497fd';

result.innerHTML = ' load..';
distance();

function distance () {
  fetch('https://www.strava.com/api/v3/clubs/197332/activities'+at)
  .then( function(resp) {
    // resp.json() returns a promise
    resp.json().then( function (data) {
      var p = 0;
      data.filter( function (activity) {
        return activity.type === 'Run' && oneMonthEarlier(activity.start_date);
      })
      .map(function(activity) {
        p += parseInt(activity.distance);
      });
      result.innerHTML = Math.round(p / 1000) + ' km';
    });
    
  }).catch( function (err) {
    console.debug(err);
  });
  
}
function oneMonthEarlier(date) {
  var today = new Date();
  var previousMonth = today.getMonth() === 0 ? '11' : ('0'+(today.getMonth()));
  var currentDay = today.getDate() < 10 ? '0'+today.getDate() : today.getDate();
  var year = today.getFullYear();
  if(previousMonth === '11') {
    year = today.getFullYear()-1;
  }
  return new Date(date) > new Date(year + '-'+previousMonth+'-'+currentDay+'T00:00:00Z')
}
</script>
</body>
</html>